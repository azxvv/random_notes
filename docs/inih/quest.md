[toc]

# Quest

# no 1：如何解析的ini文件

1. 使用fopen打开文件
2. 调用ini_parse_file → ini_parse_stream
3. 初始化缓冲区（栈或堆）
4. 循环读取行
5. 解析行：
   5.1 处理超长行（丢弃超出部分）
   5.2 删除行尾空白
   5.3 判断是否为注释行（是则跳过）
   5.4 判断是否为多行值的延续（是则追加到上一行的值）
   5.5 判断是否为新节（[section]）
       - 是：提取节名，更新当前节
       - 否：解析键值对
   5.6 解析键值对：
       - 查找=或:作为分隔符
       - 提取键（分隔符前的部分，清理右侧空白）
       - 提取值（分隔符后的部分，清理左侧空白）
       - 处理行内注释（截断注释符后的内容）
       - 清理值的右侧空白
       - 调用回调函数处理键值对
6. 释放缓冲区，关闭文件

# no 2：这个项目有什么问题

- 错误处理：错误码粒度不足，仅返回错误行号，缺乏具体错误类型（如 “缺少]”、“无效键值对”），这会让不熟悉ini文件的人看到行号，但是不知道为啥错误的人摸不着头脑

- 解决方法：扩展错误码枚举，或通过回调函数传递详细错误信息。

## 线程安全性

- 全局状态依赖：prev_name用于多行值处理，在多线程环境下可能导致数据竞争。

- 解决方法：可通过为每个解析器实例分配独立的上下文结构体，避免全局变量。

## 兼容性限制

- 行内注释必须以空白字符开头（如key=value ;comment），不支持key=value;comment。

- 节名必须用[]包裹，不支持无节名的全局配置。

## 功能不足

库仅提供顺序解析，不支持随机访问或索引查询。